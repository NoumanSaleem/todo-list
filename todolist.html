<html>
    <head>
        <style>
        html {
            font-family: 'Helvetica';
            background: #dadada;
        }
        .checked {
            text-decoration: line-through;
        }
        .block {
            display: inline-block;
            width: 250px;
        }
        .main-div {
            display: inline-block;
            width: auto;
            background: #000000ad;
        }
        .form-div {
            display: inline-block;
            width: 250px;
            background: #dadada;
            padding: 10px;
            margin: 10px;
        }
        .list-div {
            display: inline-block;
            width: 500px;
            background: #dadada;
            padding: 0px 10px 0px;
            margin: 10px 10px 10px 0px;
            vertical-align: top;
        }
        h1 {
            font-size: 20px;
            font-weight: bold;
        }
        .header {
            height: 40px;
            background: #000000ad;
            color: white;
            line-height: 40px;
            text-align: left;
            padding-left: 10px;
            margin-bottom: 10px;
        }
        ul {
            margin-left:-20px;
        }
        li {
            list-style: none;
            margin: 10px auto;
        }
        </style>
        <title>
            To-Do List
        </title>
    </head>
    <body>
        
        <div class="header">
        <h1>To-Do List</h1>
        </div>
        <div class="main-div">
            <div class="form-div">
        <form id="form" action="">
            <input class="block" style="padding: 10px" id="input" placeholder="Add New To-Do Item" autocomplete="off"><br>
            <input class="block" style="text-align: center" type="time" id="time" value="12:00" required ><br>
            <input class="block" style="text-align: center" type="date" id="date" required ><br>
            <button class="block" id="addBtn">Add to List</button></form>
            <button class="block" id="clrBtn">Clear List</button></div>
            <div class="list-div">
            <ul id="list"></ul></div></div>
                            
    <script>
        var data = [];
        var key;
        document.querySelector("#date").valueAsDate = new Date();
        const addBtn = document.querySelector("#addBtn");
        const input = document.querySelector("#input");
        const form = document.querySelector("#form");
        var list = document.querySelector("#list");
        var date = document.querySelector("#date");
        var time = document.querySelector("#time");
        const clrBtn = document.querySelector("#clrBtn");
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        form.addEventListener("submit", function(e){
            e.preventDefault();
            const todo = {"key": key, "text": input.value, "time": time.value, "date": date.value, "done": false};
            data.push(todo);
            renderTodo(todo, key);
            save();
            key++;
            input.value = "";
        }, false);

        const clrClick = (e) => {
            e.preventDefault();
            list.innerHTML = "";
            window.localStorage.clear();
            data = [];
            key = 0;
        }

        function formatDate(date){
            return days[date.getDay()] + ", " + months[date.getMonth()] + " " + date.getDate();
        }
        
        function renderTodo(todo, key) {
            var newList = document.createElement("li");
            var formattedDate =  formatDate(new Date(todo.date));
            newList.textContent = todo.text + " by " + todo.time + " on " + formattedDate;
            newList.appendChild(dltBtn(key));
            newList.insertBefore(checkbox(todo), newList.childNodes[0]);
            list.appendChild(newList);
        }
        function checkbox(todo) {
            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.addEventListener("click", checkPost)
            if (todo.done === true)
            {
                //checkbox.checked = true;
                //todo.classList.add("checked");
            }
            return checkbox;
        }

        function checkPost(e) {
            e.preventDefault();
            if (e.target.parentNode.classList.contains("checked")){
                e.target.parentNode.classList.remove("checked");
                //e.target.parentNode.done = false;
                save();
            }
            else {
                e.target.parentNode.classList.add("checked");
                //e.target.parentNode.done = true;
                save();
            }
        }

        function deletePost(e) {
            e.preventDefault();
            var target = data.findIndex(x => x.key == e.target.dataset.key);
            console.log(e.target.dataset.key);
            console.log(target);
            data.splice(target, 1);
            e.target.parentNode.remove();
            key--;
            save();
        }

        function dltBtn(key){
            var dltBtn = document.createElement("button");
            dltBtn.dataset.key = key;
            dltBtn.textContent = "Delete";
            dltBtn.addEventListener("click", deletePost);
            return dltBtn;
        }

        function save() {
            window.localStorage.setItem("data", JSON.stringify(data));
        }

        function getSaved() {
            data = JSON.parse(window.localStorage.getItem("data"));
            if (!data) {
                list.innerHTML = "";
                data = [];
                key = 0;
            }
            else {
                for (var i=0; i<data.length; i++){
                    key = i;
                    renderTodo(data[i], key);
                    //key = data.length;
                }
            }
        }

        clrBtn.addEventListener("click", clrClick, false);
        getSaved();
        //key = data.length;

    </script>
    </body>
</html>